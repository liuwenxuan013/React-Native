import bunyan from 'bunyan';

import ProvisioningProfile from '../provisioningProfile';

import { provisioningProfile } from './fixtures';

const logger = bunyan.createLogger({ level: 'error', name: 'provisioningProfileTest' });

describe('ProvisioningProfile class', () => {
  describe('verifyCertificate method', () => {
    let pp: ProvisioningProfile;

    beforeAll(() => {
      pp = new ProvisioningProfile(logger, Buffer.from(provisioningProfile.dataBase64, 'base64'));
    });

    afterAll(async () => {
      await pp.destroy();
    });

    it('shouldn\'t throw any error if the provisioning profile and distribution certificate match', async () => {
      await pp.init();

      expect(
        () => pp.verifyCertificate(provisioningProfile.certFingerprint),
      ).not.toThrow();
    });

    it('should throw an error if the provisioning profile and distribution certificate don\'t match', async () => {
      await pp.init();

      expect(
        () => pp.verifyCertificate('2137'),
      ).toThrowError(/don't match/);
    });
  });
});
